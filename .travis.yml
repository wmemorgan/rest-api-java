language: java - openjdk11
services:
- docker
branches:
  only:
  - master
  - dev
  - cicd
env:
  global:
  - secure: xT3vEQz5cPxmtTrEEeiUNiWkXR89RiVGjP8gZjmS3mAT78R6gMKq+xeACWqzKdEuPCtCet2Ye9Uytm5q83dvakcSMzyYnBb+rwmCuzsxBw7FtCrJ8lkmpbGh09PA8Tx4XkYh0ZM7Wifc4zzSHDgcbf9SSiD76tKBdyUW3/X6/DtdkqZf9l9Qlr+SH06IPcYQs13DiLJA41whnW57bLLI41lIoeB7t07LTAn0tP7VCIURt6YTXxJOQAHz1B4pIeH0+qzHehivCSmZa+rw45Bke473LZ8Nf5IpLM84AW6gzLwurfCYTDyw4kKFuN3EY/sidH+EgiiLcqEnylSU8WCJQDY2vD4k3DTd/IruIIHZ9IygEujUHfUI2bHiKF7TdkXsgRa+LyMUFL9LENgmdRkV2XLXg0rc4xsuxTy6j0rnGBvfXmtDJ2M/hu4bXG85t4moMYLAWFo3X7wslb/gRnEOQ5GaIMc6V4sEpSSqHG+a2c8XxBz9B37n1ZfkRY6Zhc4KCOnjZ6tH7e+1f6zgAImFW4y04xUK6n8aNczoF4P+20L78p25Fetylrfty5IDcY+qetM6MjRCOtOAwi1qAm7/gBOQOsQICDqlBOICOsex7jlVM2oDEh2ItYbyoPteO/UbZhFh61BUjX8iOI48VW3hbXip4yUbsPt0yLcAd5xlye4=
  - secure: emJmFUSayqwml+akXZJoaJzqVBPFGtRrZWBBtEDgjIS3u0GrK3u2YdUOQPz6a/KBqVNxDizyoby0Qkxn0HhzVA2cSRE3c9K9d/jQB85FzKzaE6DrfLnFtNeYzMoLLRmRmDu4ISVYooMtTGgVKXNaQZMHabmmq+/ePBYoZvRlsf3zHNHA/YVdD208w9n/sthxMYTJg02pcWjtwNOeqRm280XWLN1o57Tv3CuoSiXuESA3fdqCi7FszUl1eLQSc6sOFEEpd2T8t0lyDcTZd7MK3l9uk7aFuOijz7yaHgfrGG/J0Z0H46phUgOsqJXCFs3FTe5ArZQYLgsRronMM8JP3kz22InIRl4ubTYFamY7NMaO8fb/8gshg3W4QQ4x9yvveFF4Inanm7W0BjybC9wHhrYTfZfAnvSMYalAX2ysjdn8mGmKYsm9ggP2njqohL4AYTs8Ivd7Ow/rqRGdpfddpAPVZFoyTYKEXilK1LFEUdz1bv9yC2dWbUXqwiUvKEIPmEAVFX/HpYednRTxKlgVkuLvhce0TgpOMzoT+yaBNoV636ju4ov96GMvvx5jBnEe74s1IfwgPdk3ILKnt7oL+lx/zmFR5xnDmYWcly52o+4MCqp0Ybf8g+6bC2kyUHrnMt7oLhUEPZ4/SrbmzTaT1m5aYN2Z2asNK7BD2FWQ7MQ=
  - secure: B/2ZvB6RcHhcDbPYa70euttPk3Imv1Wt7fRw/bBiySbiYZJInpv7tHFkElDG8OLGMRNb79ZdMvB5VxG0LhjPE13rtQL0N/KKFJIjyuUOMxkrvR2SoLFxUju8N7612N2Uy4hV78q/LIj64ZnuHGEgHeulWQUeIxzHSjup2e8o+A1ceDmtbMVPp8iaWP8EAW2nkvCyKX+eUj20+yk+DD74kLWhJHQgwnJQjworxGEk2F5t1fFzy8vGcPu6pjO6EWkzmSSx/EjxQKd5AkGDXMVcWtUQ4hCFSOBz9VIPwZkEj3oyg/UIk7JMPIidlBPha8mTS3hF9uWfkPpZXDuaXRt99ijBi7Zl9vwCY26rCyjPaNnu5nkL0ISD+/Wbp+pOwbB7RrD0Kg9FtAiPQrdJlcRCni4nAIhrqRp4s4eBb9RvR5ES94Q50aKu7Kj4a4J8pV2JC+W3gMdb8Ylp6wifMbcr/E51HRXoO1IKYyPliH5U+8PdtYNCxOotKU1CPUw5nDNrohx9f7oAhbqOAeuOwGO1AaDrEhtEvuDLwSa6PN+9IHEvPKd85mNjco5O0sFCuKR8y90oz6MZwHMAaCOOZ0ixxPlyO+nYZGdUDPGP8HrJz5tu8Tqki+bzSzxK/U3o6lXyjCGXWyeCYG2d6Q92+gfr8KZJeS8fsYAg1cIVuRnblp0=
  - secure: n54l1fNLjWs4IRxH6DqBhqr9MuxwOn6s2pI3s8yQVtKTbFUVA4qypeodGq2lZYNBvw5ki9vIKOnvmJBvmjIWs04l/GQ26KYZK2k+p4KyOoLWhl2NTf3NT3jDwlrZqarEHdTSmXsOLJ2Ezd0fZzI7rZQW22hQPeW4qV2X9wxCwCVCB0hEJC2cFGflP6e2+nokpzmes30A6Vp/aSiOD4c1qmuDydytF3RW0ec5NHOVsc1WSTkCnDH7rLN0xK61WNPTsLbMmwqEhNFudJuzQWVOwdZLbxYzArShO8WQX21kFINPeodOYj4nSculmhAwNq/unt8Wpbh5QA8SJxs4SQZeBFrMbN34xOJnHAScFbniFe/8cVRA+zpqlzssxzSzmXpvvSRb9ZbC+Y5d2IJLyq9ct4x08Mo468LypAqKNPvYqw/y+iCzka8aM6RI4O6ATxc3lIJPWVRThCPQDDSpw9+aGGD/YFU8dItd48AFOZPJBHQAzHi5scr5lVZ47YmwjDNKfY/+y1rWW+W7wov/64K73kY76PAuFuHFQ1RliyjzemUFC2+7KfQ223e4UE7eCGrqW9TalKzpCqZt6CNbmx0lVBzxERBIzYY7eAF3pgFa3TpFT4+Y2gYjtLUk5w1AhCZI9+V2Nyu6kd9+n7+M0cDX4lnqkuGUWo/0d03JSZPDjSk=
  - secure: CUyV5Zb78It2s9OVraPFIz7CCI5feKPyq9vGJsa/yn0/fzMJyrcc0q//a7snetv3QqbwCcARtEm4QEOG70no6Hg0jZN8WiQuaKqfEMuNMQy6H+piKX5rA4UfTl5/zmoTchvgLpQMfcbk4Fy6PmTj0ncT8t21SVohYIGNLHeg++WO99piuXyFymDQd5pL0Y2Z/TkR6y5Pr/QjO9yVJFjAKe3faZA+oa2N/KiOMmniYw0HfG83KZgb36wQy2DcQLKMmer2pzHvkPTUJhuDgxfkhGQWhlZVHx0SxadCaXcxOgdTCNIpGrxEXmaOKrQTSFJZeWnFvH9TIsxYY42Zt+BUUKVJSvd/oc3nEoTwgz1cw/KAILt9jm7MiL2icLQ/WnSkAB5sfNCMwxWlKuNUMfguuyjorC9DNepKbMrJPlHhQ1wrJN8nyEw19NrvJGh9SYCapznQz0IiFTNlgnjckGb+Dpb4rrKnuJj8Ka/NtkWduCb03DcNvp40N0KBdDWWbMDyhO8g9yhJwHVwcD5ZCbYFRS7oZXEYtARp0VNOMFJ8Tx8aoFlICOuRCnQWb91ivPQIpa2DN7kxIxfVtzLT2ACVAZnWRWURE4d0XCtc9i9yHaoK0nGa5QZB57lWfQ5JnfzRM3L52+Dzyql0T4v45cbj6ePcvGNpIKWj3DWKdk2OETU=
before_script: cd api
before_install:
- docker pull openjdk:11-jre-slim-sid
script:
- mvn test
- mvn clean package
after_success:
- export COMMIT=${TRAVIS_COMMIT::7}
- export TAG=`if [ ! -z "$TRAVIS_TAG" ]; then echo "$TRAVIS_TAG"; else echo "$TRAVIS_BRANCH--$COMMIT";
  fi`
- docker login -u $DOCKER_USER -p $DOCKER_PASS
- docker-compose build
- docker tag $IMAGE_NAME:latest $IMAGE_NAME:$TAG
- docker push $IMAGE_NAME:$TAG
deploy:
  provider: heroku
  api-key:
    secure: emJmFUSayqwml+akXZJoaJzqVBPFGtRrZWBBtEDgjIS3u0GrK3u2YdUOQPz6a/KBqVNxDizyoby0Qkxn0HhzVA2cSRE3c9K9d/jQB85FzKzaE6DrfLnFtNeYzMoLLRmRmDu4ISVYooMtTGgVKXNaQZMHabmmq+/ePBYoZvRlsf3zHNHA/YVdD208w9n/sthxMYTJg02pcWjtwNOeqRm280XWLN1o57Tv3CuoSiXuESA3fdqCi7FszUl1eLQSc6sOFEEpd2T8t0lyDcTZd7MK3l9uk7aFuOijz7yaHgfrGG/J0Z0H46phUgOsqJXCFs3FTe5ArZQYLgsRronMM8JP3kz22InIRl4ubTYFamY7NMaO8fb/8gshg3W4QQ4x9yvveFF4Inanm7W0BjybC9wHhrYTfZfAnvSMYalAX2ysjdn8mGmKYsm9ggP2njqohL4AYTs8Ivd7Ow/rqRGdpfddpAPVZFoyTYKEXilK1LFEUdz1bv9yC2dWbUXqwiUvKEIPmEAVFX/HpYednRTxKlgVkuLvhce0TgpOMzoT+yaBNoV636ju4ov96GMvvx5jBnEe74s1IfwgPdk3ILKnt7oL+lx/zmFR5xnDmYWcly52o+4MCqp0Ybf8g+6bC2kyUHrnMt7oLhUEPZ4/SrbmzTaT1m5aYN2Z2asNK7BD2FWQ7MQ=
  app: wme-rest-api-java
  on:
    tags: true
    repo: "${IMAGE_NAME}"
dd:
  secure: emJmFUSayqwml+akXZJoaJzqVBPFGtRrZWBBtEDgjIS3u0GrK3u2YdUOQPz6a/KBqVNxDizyoby0Qkxn0HhzVA2cSRE3c9K9d/jQB85FzKzaE6DrfLnFtNeYzMoLLRmRmDu4ISVYooMtTGgVKXNaQZMHabmmq+/ePBYoZvRlsf3zHNHA/YVdD208w9n/sthxMYTJg02pcWjtwNOeqRm280XWLN1o57Tv3CuoSiXuESA3fdqCi7FszUl1eLQSc6sOFEEpd2T8t0lyDcTZd7MK3l9uk7aFuOijz7yaHgfrGG/J0Z0H46phUgOsqJXCFs3FTe5ArZQYLgsRronMM8JP3kz22InIRl4ubTYFamY7NMaO8fb/8gshg3W4QQ4x9yvveFF4Inanm7W0BjybC9wHhrYTfZfAnvSMYalAX2ysjdn8mGmKYsm9ggP2njqohL4AYTs8Ivd7Ow/rqRGdpfddpAPVZFoyTYKEXilK1LFEUdz1bv9yC2dWbUXqwiUvKEIPmEAVFX/HpYednRTxKlgVkuLvhce0TgpOMzoT+yaBNoV636ju4ov96GMvvx5jBnEe74s1IfwgPdk3ILKnt7oL+lx/zmFR5xnDmYWcly52o+4MCqp0Ybf8g+6bC2kyUHrnMt7oLhUEPZ4/SrbmzTaT1m5aYN2Z2asNK7BD2FWQ7MQ=
